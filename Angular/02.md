# Angular 9 : Des donn√©es dynamiques ! - Cours

> Dans cette partie, nous allons voir comment rendre notre code dynamique. Dans le cours pr√©c√©dent, nous avons vu comment cr√©er un projet et construire notre premier component.

> Nous allons maintenant construire un nouveau projet bas√© sur *Tour of Heroes*, l'appli d'exemple de la documentation officielle de Angular que vous pouvez [retrouver ici](https://angular.io/tutorial) !

> Il s'agit d'un dashboard de gestion pour une agence de recrutement de h√©ros : on pourra ajouter, modifier, lister nos h√©ros.

> Vous apprendrez √† lire la documentation de Angular et commencer √† trouver les informations par vous-m√™me.

> Nous irons ensuite un peu plus loin que le tutoriel Angular pour ajouter une gestion de combat entre nos h√©ros !

## Cr√©er le projet
- Faites l'[exercice 3](exercices.md#exercice-3).

Au fait, comment est g√©r√© le component principal de notre application, celui qui contient les autres components ? En fait, il est appel√© dans le fichier `src/index.html` avec la  balise `<app-root>`.

Ce `<app-root>` correspond en fait au `app.component` qui se trouve d√©j√† dans le dossier `src` et qui est compos√©, comme tous les composants, de trois √©l√©ments :
- `app.component.html` ce qui va √™tre affich√©
- `app.component.scss` le CSS propre √† ce component
- `app.component.ts` la logique de ce component

C'est quoi, la "logique" du component ? C'est en fait tous les m√©canismes, les variables, le code Javascript (enfin, Typescript !) qui sera utilis√© dans ce component.

La structure de ce fichier est un peu particuli√®re : on y trouve une *classe* `AppComponent`, au dessus, un *d√©corateur* `@Component()`... On d√©couvrira petit √† petit tous ces √©l√©ments.

Mais pour commencer, travaillons dans la classe `AppComponent` et ajoutons-lui une variable nomm√©e `subTitle` et qui contiendra `"Ma premi√®re application Angular !"`.

![](img/c0201.png)

C'est une variable un peu particuli√®re : par de `var`, `let`, `const` ici ! En fait, quand on d√©clare une variable dans une classe, on appelle √ßa un *attribut*. C'est une variable un peu particuli√®re qui appartient √† la classe.

## Les classes

Une classe est une structure de code qui nous permet de stocker des informations bien tri√©es dedans. Par exemple, un array ou un objet vous permettent de stocker et trier des lots d'informations (un array de noms, un array de pays avec ses habitants et sa capitale...).

Une classe, c'est un array... En mieux ! √Ä un array, on peut lui donner toutes les informations que l'on souhaite, par exemple :

```js
let countries = [
    {
        name: "France",
        capital: "Paris",
        population: 66990000
    },
    {
        name: "Germany",
        capital: "Berlin",
        population: 82790000
    }
]
```

Mais on peut aussi lui donner des informations un peu bizarres sans aucun contr√¥le :
```js
let countries = [
    {
        name: "France",
        capital: "Paris",
        population: 66990000
    },
    {
        name: "Allemagne",
        capital: "Berlin",
        population: 82790000
    },
    {
        name: "Jar-Jar Binks",
        capital: "Otoh Gunga",
        friends: [
            "Qui-Gon Jinn",
            "Obi-Wan Kenobi"
        ]
    }
]
```

Une classe, c'est en fait un "super array" √† qui on va d√©finir le format de base, des donn√©es par d√©faut, pour √©viter ce genre d'erreurs !

> Attention : √† partir de maintenant, le code que nous saisissons est du Typescript. C'est √† dire qu'il ne fonctionnera pas dans un fichier Javascript classique. Au final, lorsque l'on compile le Typescript, un fichier Javascript est cr√©√© en bout de file. L'avantage de Typescript, c'est donc d'utiliser des fonctionnalit√©s avanc√©es que Javascript seul n'a pas (ou qui sont difficiles √† coder en Javascript natif, ou encore des fonctionnalit√©s pas encore sorties).

Pour d√©finir ce "format", nous allons dire qu'un pays doit avoir une capitale (en `string`) et une  population (en `number`). De plus, nous allons nommer notre classe `Country` puisqu'elle repr√©sente un pays.

- Cr√©ez le fichier `src/app/Country.ts`. Attention au `C` majuscule ! Cette notation s'appelle `PascalCase` et est une convention obligatoire pour le nommage des classes.

![](img/c0202.png)

Et voil√† ! Je peux maintenant cr√©er des pays sans risquer d'ajouter un champ inutile (auquel cas mon IDE me mettra une erreur !) :

![](img/c0203.png)

Une classe, c'est aussi un nouveau type de donn√©es. De la m√™me mani√®re que `string` est un type de donn√©es qui poss√®de tous les caract√®res possibles, `number` un type de donn√©es qui ne poss√®de que des chiffres ou `object` qui poss√®de plusieurs strings, numbers et sous objets, `Country` est un type de donn√©es qui poss√®de une string `capital` et un number `population`.

Pour illustrer cela, vous pouvez cr√©er une classe `Continent` (dans le m√™me fichier pour cette fois car c'est un exercice) qui elle, contiendra un attribut `countries` qui prendra un tableau d'√©l√©ments de type... `Country` !

- Pour indiquer un tableau de string, on type avec `string[]`.
- Pour indiquer un tableau de `Country`, on type avec `Country[]`.

![](img/c0204.png)

- Faites l'[exercice 4](exercices.md#exercice-4).
- Faites l'[exercice 5](exercices.md#exercice-5).

## Interpolation

Maintenant que notre classe poss√®de des attributs, nous allons les utiliser √† la mani√®re de Angular pour les afficher dans notre page !

Angular poss√®de un moteur de template qui permet par exemple d'utiliser dans la partie HTML des variables qui viennent de la partie Typescript. On appelle √ßa l'interpolation : c'est un mot savant qui veut simplement dire "ins√©rer une variable qui vient d'un autre fichier" ! (mais c'est bien pour raconter son job √† des amis : *j'ai du relancer mon serveur Angular parce que l'interpolation ne voulait pas marcher correctement mais sinon bonne journ√©e et toi ?* üòé)

Concr√®tement, nous pouvons utiliser les variables d√©finies dans la partie Typescript du component (ici: `app.component.ts`) en les appelant dans la partie HTML du component (ici: `app.component.html`) en saisissant le code suivant:

> Note: vous pouvez supprimer l'int√©gralit√© du contenu de `app.component.html` comme d'habitude sans risques : c'est simplement le code qui vient par d√©faut √† la construction de l'application !

> N'oubliez pas de relancer votre serveur si √ßa n'est pas d√©j√† le cas !

![](img/c0205.png)

Vous allez maintenant mettre en pratique toutes vos connaissances pour cr√©er un component `heroes` qui contiendra la liste des h√©ros.

- Faites l'[exercice 6](exercices.md#exercice-6).

Notre composant s'affiche, parfait ! Nous allons maintenant d√©finir ce qu'est un h√©ros. Il doit avoir :
-  un `id` (pour  l'identifier parmi ses pairs !), de type `number`
-  un `name` (id√©alement, qui passe bien au cin√©ma !), de type `string`

Nous avons un outil pour d√©finir un ensemble de donn√©es: ce sont les classes ! Pour notre exercice, nous allons utiliser un type sp√©cial de classes, ce sont les interfaces. Elles fonctionnent presque comme des classes et nous d√©taillerons plus tard leur m√©canisme :


Nom du fichier: `NomDeLinterface.ts`
```ts
export interface NomDeLinterface {
    attribut: type;
}
```

L'int√©r√™t de nos interfaces (ou classes), c'est de les utiliser dans un component qui utilisera ce mod√®le de donn√©es. Pour l'importer, il faut l'indiquer dans les imports de notre component sous la forme de :

```ts
import { ElementAImporter } from '../chemin/relatif/du/fichier/source';
```

![](img/c0213.png)

> Note: nous avons indiqu√© "export" dans le fichier de l'interface, car lorsque l'on appelle ce fichier, on veut dire que l'interface est disponible √† l'ext√©rieur, par le fichier qui l'a import√©.

> Du coup, quand on fait un "import", on pr√©cise ce que l'on veut importer du fichier (ici, `NomDeLinterface`).

- Faites l'[exercice 7](exercices.md#exercice-7).
- Faites l'[exercice 8](exercices.md#exercice-8).

## Databinding

Dans nos composant Angular, nous allons √™tre capables de communiquer et modifier des donn√©es dans deux sens :
- depuis le HTML vers le Typescript (mon utilisateur change les donn√©es d'un formulaire, clique quelque part par exemple) : on √©coute un √©v√®nement, c'est du `event binding`

- depuis le Typescript vers le HTML : un fonction, m√©thode, des donn√©es issues d'une API... qui changent une donn√©e d'affichage : √ßa touche aux attributs (properties) du component, c'est du `property binding`.

> L'interpolation, c'est une des mani√®res de faire du property binding !

### Event Binding

Nous allons lier un √©v√®nement venant du HTML √† une action dans le Typescript. Par exemple, quand l'utilisateur clique sur le nom du h√©ros, on envoie un `console.log()` pour dire que le h√©ros a √©t√© cliqu√©.

Dans l'ordre, nos t√¢ches sont :
1. √âcrire l'action √† effectuer dans le Typescript
2. Attacher un event listener dans le HTML


#### 1. √âcrire l'action √† effectuer

Nous allons √©crire une fonction dans notre classe `HeroesComponent` qui s'ex√©cutera lors du clic sur un h√©ros.

> Une fonction dans une classe ?! Si on se souvient bien de ce qu'est une classe... C'est une repr√©sentation de donn√©es, une sorte de super array. Une des particularit√©s qu'ont les classes en plus des arrays, c'est d'avoir des actions √† effectuer ! Ce sont en fait des fonctions comme on les conna√Æt d√©j√† en Javascript. Mais comme elle se situe dans une classe, on appelle √ßa une m√©thode. Donc en r√©sum√©, quand on fera de la programmation orient√©e objet, on parlera de :
> Proc√©dural | Orient√© objet
> ---------|----------
>  Variable | Attribut
>  Fonction | M√©thode

Ajoutez dans `heroes.component.ts` la m√©thode suivante :

![](img/c0219.png)

#### 2. Attacher un event listener

Modifiez le `heroes.component.html` pour ajouter un event listener qui d√©clanchera la m√©thode cr√©√©e ci-dessus. Angular est capable  d'√©couter tous les √©v√®nements du DOM comme expliqu√© dans la doc [ici](https://angular.io/guide/user-input), nous allons choisir l'event `click`.

![](img/c0220.png)

Si tout se passe bien, en cliquant sur le nom du h√©ros, un message devrait appara√Ætre dans la console du navigateur !

![](img/c0228.png)


### Property Binding

Nous allons voir une autre mani√®re que l'interpolation de lire des donn√©es venant du Typescript. Cette fois, imaginons que notre liste de h√©ros ne peut pas √™tre embauch√©e pour le moment. Cr√©ons un attribut pour cela :

![](img/c0221.png)

> Normalement, cette donn√©e viendrait d'une base de donn√©es que Angular consulterait avec une API. Comme nous ne savons pas (encore!) le faire, nous simulons cette donn√©e en l'√©crivant en dur.

Dans le HTML, cr√©ons un bouton "Embaucher" qui ne sera actif que si `isActivated` est vrai (donc : il sera `disabled` si `isActivated` n'est pas vrai) :

![](img/c0222.png)

Et voil√† ! Testez en changeant la valeur du bool√©en pour voir tout fonctionne bien. Par exemple ci-dessous, on a `isActivated = false`, le bouton est `disabled` :

![](img/c0223.png)

- Faites l'[exercice 9](exercices.md#exercice-9).

### Two-Way Binding

Cette-fois, nous allons voir comment rattacher les donn√©es... Dans les deux sens (two-way) en m√™me temps ! Par exemple :

1. une variable sert de nom √† l'affichage (property binding)
2. l'utilisateur modifie un formulaire... (event binding)
3. ... ce qui modifie la variable de nom (property binding)

- Faites l'[exercice 10](exercices.md#exercice-10).

√Ä l'issue de l'exercice 10, vous devriez avoir un formulaire qui contient le nom du h√©ros. Ce que nous souhaiterions faire, c'est de pouvoir changer le nom du h√©ros en temps r√©el lorsque nous modifions le champ du formulaire !

![](img/c0234.gif)


Pour cela, nous allons un peu changer notre formulaire et lui dire que sa donn√©e vient d'un `Model` (un Model, c'est une repr√©sentation de donn√©e en POO), et ce model, c'est l'attribut `hero.name`.

Et comme c'est un binding dans les deux sens (event/property)... On  utilisera √† la fois `[]` et √† la fois `()` !

![](img/c0231.png)

Par contre, on a maintenant une erreur de compilation. Ce `ngModel` se sert d'un module que nous avons oubli√© d'importer ! Ajoutez la ligne d'import suivante dans le Typescript :

![](img/c0232.png)

Enfin, comme il s'agit d'un import qui vient de l'ext√©rieur du projet (√† l'inverse de `Hero.ts` qui lui vient de l'int√©rieur du projet), nous devons appeler ce module dans un fichier de configuration nomm√© `app.module.ts` :

![](img/c0233.png)


> Remarquez que dans ce fichier, on y trouve aussi `HeroesComponent` ! Cette d√©claration est obligatoire pour chaque component et c'est `ng g c` qui a mis √† jour ce fichier pour nous.

- Faites l'[exercice 11](exercices.md#exercice-11).
